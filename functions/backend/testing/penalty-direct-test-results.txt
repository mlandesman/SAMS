╔════════════════════════════════════════════════════════════╗
║  PENALTY OPTIMIZATION - DIRECT SERVICE TEST (Task WB2)    ║
╚════════════════════════════════════════════════════════════╝

🔥 Initializing Firebase Admin...
✅ Firebase Admin initialized

⏱️  Starting test execution...

📍 Test Configuration:
   - Client ID: AVII
   - Test Units: [203, 104]

🔄 TEST 1: Full Penalty Recalculation (All Units - Baseline)
═══════════════════════════════════════════════════════════
🔄 [PENALTY_RECALC] Starting penalty recalculation for client AVII (all units)

❌ Full recalculation test failed: Recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.
Error: Recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.
    at testFullPenaltyRecalculation (file:///Users/michael/Library/CloudStorage/GoogleDrive-michael@landesman.com/My%20Drive/Sandyland/SAMS/backend/testing/testPenaltyOptimizationDirect.js:61:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async runTests (file:///Users/michael/Library/CloudStorage/GoogleDrive-michael@landesman.com/My%20Drive/Sandyland/SAMS/backend/testing/testPenaltyOptimizationDirect.js:187:24)

🎯 TEST 2: Unit-Scoped Penalty Recalculation (Surgical Update)
═══════════════════════════════════════════════════════════
🎯 [PENALTY_RECALC] Surgical update: recalculating penalties for 2 unit(s)
🔄 [PENALTY_RECALC] Starting penalty recalculation for client AVII (units: [203, 104])

❌ Unit-scoped recalculation test failed: Unit-scoped recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.
Error: Unit-scoped recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.
    at testUnitScopedPenaltyRecalculation (file:///Users/michael/Library/CloudStorage/GoogleDrive-michael@landesman.com/My%20Drive/Sandyland/SAMS/backend/testing/testPenaltyOptimizationDirect.js:105:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async runTests (file:///Users/michael/Library/CloudStorage/GoogleDrive-michael@landesman.com/My%20Drive/Sandyland/SAMS/backend/testing/testPenaltyOptimizationDirect.js:190:26)

📊 TEST 3: Performance Comparison Analysis
═══════════════════════════════════════════════════════════
⚠️  Cannot compare performance - one or both tests failed


╔════════════════════════════════════════════════════════════╗
║                    TEST SUITE SUMMARY                      ║
╚════════════════════════════════════════════════════════════╝

❌ SOME TESTS FAILED

Test Results:
   - Full recalculation: ❌
   - Scoped recalculation: ❌
   - Performance comparison: ❌
     Error: Recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.
     Error: Unit-scoped recalculation failed: 16 UNAUTHENTICATED: Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://developers.google.com/identity/sign-in/web/devconsole-project.

✅ Test suite execution complete!

