# Client Import Strategy -- **CRITICAL PATH**, **URGENT**

## Requirements
We need to do a full import of the current MTC data to test our environment and prepare for moving MTC into production this week.

## Strategy
While we are starting with the known entity of MTC (Marina Turquesa Condominiums), the scripts should be written and documented to be extended for our next clients.  We expect to have data next week for Aventuras Villa II but we do not know what format or what content they contain.

The JSON files have been extracted from the Google Sheets for MTC.  The files are all in SAMS/MTCdata
    1. Users.json
    2. Units.json
    3. UnitSizes.json
    4. Categories.json
    5. AutoCategorize.json
    6. Vendors.json
    7. Transactions.json
    8. HOADues.json

## File Structures

### Users.json
Basic data for the users collection at the top of SAMS (above the client)
``` 
  {
    "LastName": "Landesman",
    "Unit": "PH4D",
    "Email": "ms@landesman.com",
    "Password": "0331"
  }
```

### Units.json
Created with UnitID used as docId
UnitID -> Unit is other files.
Dues is the monthly dues amount
% Owner is the percentage of ownership in the building => {unitId}percentOwned:
```
  {
    "UnitID": "PH4D",
    "Owner": "Michael Landesman",
    "eMail": "ms@landesman.com",
    "Dues": 5800,
    "% Owner": 0.116
  }
```  

### UnitSize.json
Mapped and combined into Units data during import. 
Condo -> UnitID -> Unit => {unitId}
Ignore m² (being calculated in app)
ft² Size in Square Feet => {unitId}squareFeet
```
  {
    "Condo": "PH4D",
    "m² ": 197.82,
    "ft² ": 2129.3146979999997,
    "%": 0.113714489371242
  },
```

### Categories.json
Mapped to {clientId} categories collection using autogenerated docId
Categories => description
Categories => name
 ```
  {
    "Categories": "HOA Dues"
  },
  {
    "Categories": "Account Credit"
  },
```

### AutoCategorize.json
Store the Category with the matching Vendor for future automation
```
  {
    "Vendor": "Colonos",
    "Category": "Colonos Fee"
  },
```

### Vendors.json
```
 {
    "Vendors": "Acuatica Gamez"
  },
  {
    "Vendors": "Administration Fee"
  },
```
### Transactions.json
Blank field at top is a Transaction ID from the Google System => googleId (if not null or empty)
Account "MTC Bank" => bank-001, accountType: bank, accountName: "CiBanco"
Account "Cash Account" => cash-001, accountType: cash, accountName: "Cash"
```
  {
    "": 25118,
    "Date": "2025-06-19T22:55:41.585Z",
    "Vendor": "Deposit",
    "Category": "HOA Dues",
    "Unit": "2C (Kopeika)",
    "Amount": 13200,
    "Account": "MTC Bank",
    "Notes": "Jul, Aug, Sep 2025 Wise → CiBanco"
  },
  {
    "": "",
    "Date": "2025-06-20T18:44:31.144Z",
    "Vendor": "Sergio Hernandez",
    "Category": "Staff: Maintenance Staff",
    "Unit": "",
    "Amount": -1800,
    "Account": "Cash Account",
    "Notes": "Weekly Salary"
  }
```

### HOADues.json
HOA Dues Payments are structured differently in SAMS
Example of below JSON entry:
Looking at the notes, it ends with nSeq: 25009.  There will be a transction import with the first field (no label) that has the string 25009.  That was the full deposit that got split into these months (note: Jan, Feb, Mar 2025).  Months 4-6 show Seq: 25018 which will be a different transaction
That transactionId will be stored with each entry
```
MTC/units/PH4D/dues/2025/payments[0].month=1
MTC/units/PH4D/dues/2025/payments[0].notes=notes
MTC/units/PH4D/dues/2025/payments[0].paid=5800
MTC/units/PH4D/dues/2025/payments[0].transactionId="AGPMbCIjwJSTelhTmvRr"
MTC/units/PH4D/dues/2025/payments[1].month=2
MTC/units/PH4D/dues/2025/payments[1].notes=notes
MTC/units/PH4D/dues/2025/payments[1].paid=5800
MTC/units/PH4D/dues/2025/payments[1].transactionId="AGPMbCIjwJSTelhTmvRr"
MTC/units/PH4D/dues/2025/payments[2].month=3
MTC/units/PH4D/dues/2025/payments[2].notes=notes
MTC/units/PH4D/dues/2025/payments[2].paid=5800
MTC/units/PH4D/dues/2025/payments[2].transactionId="AGPMbCIjwJSTelhTmvRr"
MTC/units/PH4D/dues/2025/payments[3].month=4
MTC/units/PH4D/dues/2025/payments[3].notes=notes
MTC/units/PH4D/dues/2025/payments[3].paid=5800
MTC/units/PH4D/dues/2025/payments[3].transactionId="AGPMbCIjwJSTelhTmvRr"
MTC/units/PH4D/dues/2025/payments[4].month=5
MTC/units/PH4D/dues/2025/payments[4].notes=notes
MTC/units/PH4D/dues/2025/payments[4].paid=5800
MTC/units/PH4D/dues/2025/payments[4].transactionId="AGPMbCIjwJSTelhTmvRr"
MTC/units/PH4D/dues/2025/payments[5].month=6
MTC/units/PH4D/dues/2025/payments[5].notes=notes
MTC/units/PH4D/dues/2025/payments[5].paid=5800
MTC/units/PH4D/dues/2025/payments[5].transactionId="AGPMbCIjwJSTelhTmvRr"
```

```
  "PH4D": {
    "scheduledAmount": 5800,
    "creditBalance": 0,
    "totalPaid": 34800,
    "outstanding": 34800,
    "payments": [
      {
        "month": 1,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Fri Dec 27 2024 16:27:51 GMT-0500 (Eastern Standard Time)\nJan, Feb, Mar 2025; BBVA → MTC Bank\nSeq: 25009"
      },
      {
        "month": 2,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Fri Dec 27 2024 16:27:51 GMT-0500 (Eastern Standard Time)\nJan, Feb, Mar 2025; BBVA → MTC Bank\nSeq: 25009"
      },
      {
        "month": 3,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Fri Dec 27 2024 16:27:51 GMT-0500 (Eastern Standard Time)\nJan, Feb, Mar 2025; BBVA → MTC Bank\nSeq: 25009"
      },
      {
        "month": 4,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Tue Dec 31 2024 20:47:08 GMT-0500 (Eastern Standard Time)\nApr, May, Jun 2025 + MXN 0.00 Credit; DolarApp\nSeq: 25018"
      },
      {
        "month": 5,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Tue Dec 31 2024 20:47:08 GMT-0500 (Eastern Standard Time)\nApr, May, Jun 2025 + MXN 0.00 Credit; DolarApp\nSeq: 25018"
      },
      {
        "month": 6,
        "paid": 5800,
        "notes": "Posted: MXN 17,400.00 on Tue Dec 31 2024 20:47:08 GMT-0500 (Eastern Standard Time)\nApr, May, Jun 2025 + MXN 0.00 Credit; DolarApp\nSeq: 25018"
      }
    ]
  }
```

## Concerns
### Order of Processing is important
* We need to enter HOA Dues after we load Transactions to map the tranxId.
* Case has been an issue with fields being name Account, account, name and accountId.  We must ensure a solid data dictionary when we load

## Next Steps
### Data Definition
First step is to CRUD functions to determine which fields we use and in what syntax.  In the current dev system we have duplicated and triplicated fields to match garbage data. We do not want to recreate that problem.  The data dictionary must be fully documented so all import scripts load the data to match the CRUD functions and not visa-versa.  Firestore is a schema-less environment so anything we push to it will be accepted.  There is no native data validation.

### Build Data Purge Scripts for {clientId} == MTC
1. _DELETE_ all documents then the collection
    1. transactions
    2. projects
    3. units
    4. vendors
    5. categories
    6. documents
    7. paymentMethods
2. _KEEP_ and collection
    1. config
    2. yearEndBalances

### Build Purge Scripts for auditLogs
1. _DELETE_ all documents
    1. auditLogs

### Build import scripts
