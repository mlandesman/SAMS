# SAMS Development Guidelines for Cursor AI

## ‚ö†Ô∏è CRITICAL PATH REQUIREMENT ‚ö†Ô∏è
**SAMS-Docs Location**: `/Users/michael/Projects/SAMS/SAMS-Docs`  
**NEVER USE GOOGLE DRIVE** - It is broken on macOS 26  
All task assignments, memory logs, and documentation MUST use the local path above.

### Common Path Mistake - DO NOT MAKE THIS ERROR
‚ùå WRONG: `/Users/michael/Projects/SAMS-Docs/` (does not exist)  
‚úÖ CORRECT: `/Users/michael/Projects/SAMS/SAMS-Docs/` (SAMS-Docs is INSIDE SAMS)

If you get "path does not exist" errors, you are likely missing the `/SAMS/` in the middle of the path.

## Project Context
This is the Sandyland Asset Management System (SAMS), a Firebase-based property management platform for HOA communities in Mexico.

## Document Creation Rules (CRITICAL)
‚ö†Ô∏è **GOOGLE DRIVE IS BROKEN - DO NOT USE** ‚ö†Ô∏è
**All APM task docs, completion logs, test results, and handovers MUST be created in LOCAL STORAGE.**

**CRITICAL: SAMS-Docs Location**
SAMS-Docs has been PERMANENTLY moved from Google Drive to local storage due to macOS 26 sync issues.

**ALWAYS USE THIS PATH**:
`/Users/michael/Projects/SAMS/SAMS-Docs`

**NEVER USE THIS PATH** (BROKEN):
~~`/Users/michael/Library/CloudStorage/GoogleDrive-michael@landesman.com/My Drive/Sandyland/SAMS-Docs`~~

**Full Documentation**:
- `/Users/michael/Projects/SAMS/SAMS-Docs/DOC_CREATION_RULES.md`
- `/Users/michael/Projects/SAMS/SAMS-Docs/PATH_CONVENTIONS.md`

**Quick Rules**:
- Task/test/phase/handover docs ‚Üí **LOCAL (/Users/michael/Projects/SAMS/SAMS-Docs/)**
- Code files ‚Üí **Local (/Users/michael/Projects/SAMS/)**
- In documentation, use `SAMS-Docs/` prefix for clarity
- In prompts for agents, use full absolute paths to `/Users/michael/Projects/SAMS/SAMS-Docs`

## APM Task Assignment Requirements
When creating task assignments for Implementation Agents, ALWAYS include:

1. **YAML Frontmatter with memory_log_path**:
   ```yaml
   ---
   memory_log_path: /Users/michael/Projects/SAMS/SAMS-Docs/apm_session/Memory/Task_Completion_Logs/[Task_Name]_[Date].md
   ---
   ```
   Where:
   - `[Task_Name]` = Brief task identifier (e.g., `Water_Bills_Task_1`, `Unified_Payment_Task_1`)
   - `[Date]` = Current date in YYYY-MM-DD format (e.g., `2025-11-03`)

2. **Standard Path Pattern**:
   - Always use the full absolute path: `/Users/michael/Projects/SAMS/SAMS-Docs`
   - Always place in `Memory/Task_Completion_Logs/` directory
   - Use consistent naming: `Task_Name_YYYY-MM-DD.md`
   - **NEVER use Google Drive path**

3. **Example**:
   ```yaml
   ---
   memory_log_path: /Users/michael/Projects/SAMS/SAMS-Docs/apm_session/Memory/Task_Completion_Logs/Unified_Payment_Task_2_Controller_2025-11-03.md
   ---
   ```

## Critical Constraints
1. **ES6 Modules Only**: All backend code MUST use ES6 exports. CommonJS breaks the system.
2. **Timezone**: All dates must be normalized to America/Cancun timezone
3. **Authentication**: All API calls require proper Firebase Auth headers
4. **Domain Routing**: Use domain-specific routes (e.g., `/hoadues/${clientId}/*` not `/clients/${clientId}/hoadues/*`)

## ‚ö†Ô∏è Engineering Rules (MUST READ) ‚ö†Ô∏è
**All agents MUST follow the SAMS Engineering Rules before making changes:**

`/Users/michael/Projects/SAMS/SAMS-Docs/SAMS Guides/Feature_Flag_Requirements.md`

Key rules:
- **Branch Discipline**: One branch per feature, never commit directly to main
- **Shared Contract Discipline**: Shared core logic is a contract ‚Äî use wrappers, not conditional semantics
- **Feature Flags**: Required for new modules, shared finance logic changes, new routes
- **PR Required**: All merges to main must go through PR review (IA ‚Üí MA ‚Üí Michael)
- **Integration Before Merge**: Always merge/rebase main into feature branch before final testing

## Active Issues & Critical Work
Before starting any task, review:
- **GitHub Issues** (https://github.com/mlandesman/SAMS/issues) for current sprint work
- **Implementation Plan**: `/Users/michael/Projects/SAMS/.apm/Implementation_Plan.md`
- **Sprint Groups**: `/Users/michael/Projects/SAMS/SAMS-Docs/apm_session/Agile/Sprint_Groups.md`
- **Roadmap**: `/Users/michael/Projects/SAMS/SAMS-Docs/apm_session/Agile/Roadmap_and_Timeline.md`

## Key Constraints to Be Aware Of
- **ES6 module compliance is CRITICAL** - never use CommonJS (breaks system)
- **No TypeScript yet** - be extra careful with types
- **Test coverage < 40%** - expect limited automated testing
- **Shared finance logic is fragile** - UPC, Statement of Account, credit balances require extra care
- **Desktop is primary** - mobile PWA is secondary, don't break desktop for mobile

## Development Patterns
1. **API Calls**: Use centralized configuration, no hardcoded URLs
2. **Error Handling**: Always implement proper error handling with user feedback
3. **Data Validation**: Validate inputs on both frontend and backend
4. **Audit Trail**: Maintain comprehensive notes in transactions
5. **Mobile/Desktop**: Desktop is primary, mobile app needs full refactor (TD-016)

## Before Making Changes
1. Check GitHub Issues #7 and #8 for critical production blockers
2. Review if issue affects shared components or mobile app
3. Consider impact on both MTC and AVII clients (multi-tenant system)
4. Verify changes work with existing data structures
5. Check APM Implementation Plan in Drive (see path above) for Priority 1-15 roadmap

## When Creating New Issues
Use the issue creation tool or follow the format in `/workspace/docs/issues 2/open/` with:
- Priority emoji (üî• HIGH, üü° MEDIUM, üü¢ LOW, üö® CRITICAL)
- Module identification
- Impact assessment
- Acceptance criteria

## Testing Requirements
- Manual testing required (low automated test coverage)
- Test with both MTC and AVII client data
- Verify timezone handling for date inputs
- Check mobile app impact if touching shared components

## Pre-PR Quality Gate (MANDATORY)
Before creating any PR or marking work complete, agents MUST:

1. **Run `bash scripts/pre-pr-checks.sh main`** ‚Äî fixes all automated findings
2. **Delete dead files** ‚Äî if you created a component and later abandoned it, delete it
3. **Verify state resets** ‚Äî components using `selectedUnitId` or `currentClient` must reset local state when those values change
4. **Check data unit consistency** ‚Äî fallback chains must not mix pesos (dashboard-summary) with centavos (unit-report)
5. **Audit navigate() targets** ‚Äî every `navigate('/route')` must point to a route the current user can access; cross-reference with `RoleProtectedRoute` in `App.jsx`
6. **Review full diff** ‚Äî read `git diff main...HEAD` as a reviewer, not as the author

